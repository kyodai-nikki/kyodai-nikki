<!DOCTYPE html><meta charset="utf-8" /><title>Redirecting…</title>
<script>
  (function () {
    // 1) <base href="..."> からベースパスを決定（なければ "/"）
    var baseEl = document.querySelector("base");
    var base = (baseEl ? baseEl.getAttribute("href") : "/") || "/";
    // 末尾スラッシュを揃える
    if (!base.endsWith("/")) base += "/";

    // 2) 現在のパスからベース部分を剥がす（プロジェクトサイト/独自ドメインどちらでもOK）
    var prefix = base.replace(/\/$/, ""); // 例: "/kyodai-nikki"
    var from = location.pathname.replace(new RegExp("^" + prefix), "");
    if (!from.startsWith("/")) from = "/" + from;

    // 3) クエリ・ハッシュも引き継いで index へ
    var target =
      base +
      "?redirect=" +
      encodeURIComponent(from + location.search + location.hash);
    location.replace(target);
  })();
</script>
